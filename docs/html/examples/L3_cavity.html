

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Photonic crystal slab cavity &mdash; Tidy3d  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/logo.svg"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../api.html" />
    <link rel="prev" title="Building and running a simulation" href="Simulation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Tidy3d
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Simulation.html">Building and running a simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Simulation.html#Loading-and-analyzing-data">Loading and analyzing data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Photonic crystal slab cavity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Coarse-simulation">Coarse simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Run-simulation-and-examine-the-spectrum">Run simulation and examine the spectrum</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Refine-simulation,-use-symmetries,-get-mode-profile">Refine simulation, use symmetries, get mode profile</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Tidy3d</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../examples.html">Examples</a> &raquo;</li>
        
      <li>Photonic crystal slab cavity</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/examples/L3_cavity.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Photonic-crystal-slab-cavity">
<h1>Photonic crystal slab cavity<a class="headerlink" href="#Photonic-crystal-slab-cavity" title="Permalink to this headline">¶</a></h1>
<p>In this notebook, we will simulate the commonly used L3 photonic crystal cavity composed of three missing holes in a hexagonal alttice of holes in a silicon slab.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">tidy3dclient</span> <span class="k">as</span> <span class="nn">td</span>
<span class="kn">from</span> <span class="nn">tidy3dclient</span> <span class="kn">import</span> <span class="n">web</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
</pre></div></div>
</div>
<div class="section" id="Coarse-simulation">
<h2>Coarse simulation<a class="headerlink" href="#Coarse-simulation" title="Permalink to this headline">¶</a></h2>
<p>We will first run a coarse simulation to examine the spectrum, and zone in on the fundamental mode of the cavity. We start with defining some general parameters.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of PhC periods in x and y directions</span>
<span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">10</span>

<span class="c1"># Lattice constant of the PhC in micron</span>
<span class="n">alattice</span> <span class="o">=</span> <span class="mf">0.4</span>

<span class="c1"># Regular PhC lattice parameters</span>
<span class="n">ra</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">alattice</span> <span class="c1"># hole radius</span>
<span class="n">d_slab</span> <span class="o">=</span> <span class="mf">0.22</span> <span class="c1"># slab thickness</span>
<span class="n">n_slab</span> <span class="o">=</span> <span class="mf">3.48</span> <span class="c1"># refractive index of the slab</span>

<span class="c1"># Materials - air and silicon</span>
<span class="n">air</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">si</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">n_slab</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Mesh step in x, y, z, in micron</span>
<span class="n">dl</span> <span class="o">=</span> <span class="mf">0.04</span>
<span class="n">mesh_step</span> <span class="o">=</span> <span class="p">[</span><span class="n">dl</span><span class="p">,</span> <span class="n">dl</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">dl</span><span class="p">]</span>

<span class="c1"># Central frequency around which we&#39;ll look for the cavity mode, in Hz</span>
<span class="n">fcen</span> <span class="o">=</span> <span class="mf">2e14</span>

<span class="c1"># Number of PML layers to use along each of the three directions.</span>
<span class="n">npml</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">pml_layers</span> <span class="o">=</span> <span class="n">npml</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,))</span>

<span class="c1"># Simulation domain size (in micron)</span>
<span class="n">sim_size</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Nx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">alattice</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">npml</span><span class="o">*</span><span class="n">mesh_step</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">((</span><span class="n">Ny</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">alattice</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">npml</span><span class="o">*</span><span class="n">mesh_step</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Next, we define the positions of the holes that make the photonic crystal structure.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Define x and y positions in one quadrant of the simulation domain</span>
<span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">Nx</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Ny</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
        <span class="n">xp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="p">(</span><span class="n">iy</span><span class="o">%</span><span class="k">2</span>)*0.5)
        <span class="n">yp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iy</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Remove the first two holes to make the L3 defect</span>
<span class="n">xp</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
<span class="n">yp</span> <span class="o">=</span> <span class="n">yp</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>


<span class="c1"># Append holes for the other three quadrants</span>
<span class="n">xf</span><span class="p">,</span> <span class="n">yf</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">):</span>
    <span class="n">xf</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">]</span>
    <span class="n">yf</span> <span class="o">+=</span> <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">xf</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span><span class="p">]</span>
        <span class="n">yf</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="n">y</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Initialize all structures.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">slab</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">Nx</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">Ny</span><span class="p">,</span> <span class="n">d_slab</span><span class="p">],</span> <span class="n">material</span><span class="o">=</span><span class="n">si</span><span class="p">)</span>

<span class="n">holes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">):</span>
    <span class="n">holes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span>
                    <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">alattice</span><span class="p">,</span>
                    <span class="n">axis</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span>
                    <span class="n">radius</span> <span class="o">=</span> <span class="n">ra</span><span class="p">,</span>
                    <span class="n">height</span> <span class="o">=</span> <span class="n">d_slab</span><span class="p">,</span>
                    <span class="n">material</span> <span class="o">=</span> <span class="n">air</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Initialize source and probes. We are looking for the fundamental mode of the L3 cavity, so we use a y-polarized source at the center of the cavity. We also place a time probe in the same location. We set the simulation runtime to extend past the source pulse, and the time probe starting time to start after the source decay, such that we can exclude the source signature from the spectrum. The duration of the source is determined by the bandwidth <code class="docutils literal notranslate"><span class="pre">fwidth</span></code> as well as by the dimensionless
parameter <code class="docutils literal notranslate"><span class="pre">offset</span></code> that defines the position in time of the peak of the source, in units of <code class="docutils literal notranslate"><span class="pre">1/fwidth</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Bandwidth in Hz</span>
<span class="n">fwidth</span> <span class="o">=</span> <span class="mf">4e13</span>
<span class="c1"># Gaussian source offset; the source peak is at time t=offset/fwidth</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mf">4.</span>

<span class="n">source</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">f0</span><span class="o">=</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">fwidth</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

<span class="c1"># Simulation run time past the source decay (around t=2*offset/fwidth)</span>
<span class="n">run_time</span> <span class="o">=</span> <span class="mi">20</span><span class="o">/</span><span class="n">fwidth</span>

<span class="c1"># Time probe at the center of the cavity</span>
<span class="n">t_start</span> <span class="o">=</span> <span class="mi">10</span><span class="o">/</span><span class="n">fwidth</span>
<span class="n">tprobe</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">TimeProbe</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">t_start</span><span class="o">=</span><span class="n">t_start</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We will make sure that we have set everything correctly after initializing the simulation. This is because the source and probe objects currently do not know what the <code class="docutils literal notranslate"><span class="pre">run_time</span></code> is. This parameter is initiated only at the time of creating a <code class="docutils literal notranslate"><span class="pre">Simulation</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">sim_size</span><span class="p">,</span>
                    <span class="n">mesh_step</span><span class="o">=</span><span class="n">mesh_step</span><span class="p">,</span>
                    <span class="n">structures</span><span class="o">=</span><span class="p">[</span><span class="n">slab</span><span class="p">]</span><span class="o">+</span><span class="n">holes</span><span class="p">,</span>
                    <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="n">source</span><span class="p">],</span>
                    <span class="n">probes</span><span class="o">=</span><span class="p">[</span><span class="n">tprobe</span><span class="p">],</span>
                    <span class="n">run_time</span><span class="o">=</span><span class="n">run_time</span><span class="p">,</span>
                    <span class="n">pml_layers</span><span class="o">=</span><span class="n">pml_layers</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">td</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">relative_eps</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">normal</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="n">td</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">relative_eps</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">normal</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Initializing simulation...
Simulation domain in number of pixels: 170, 145, 100.
Mesh step (micron): 4.00e-02, 3.46e-02, 4.00e-02.
Total number of time steps: 7602.
Estimated data size of probe tprobe1: 0.0000GB.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_L3_cavity_11_1.png" src="../_images/examples_L3_cavity_11_1.png" />
</div>
</div>
<p>We can also make sure that our source excitation, and the time interval in which we record the fields in the time probe, make sense.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check probe and source</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">tprobes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">td</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">source_time</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Tidy3D TimeProbe:
name     = tprobe1
center   = [0.0000 0.0000 0.0000]
size     = [0.0000 0.0000 0.0000]
t_start  = 2.50e-13,
t_stop   = 5.00e-13,

Number of time points: 3801
Store E:  True
Store H:  False
Has data: False
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_L3_cavity_13_1.png" src="../_images/examples_L3_cavity_13_1.png" />
</div>
</div>
</div>
<div class="section" id="Run-simulation-and-examine-the-spectrum">
<h2>Run simulation and examine the spectrum<a class="headerlink" href="#Run-simulation-and-examine-the-spectrum" title="Permalink to this headline">¶</a></h2>
<p>Now that the simulation is constructed, we can run it using the <code class="docutils literal notranslate"><span class="pre">web</span></code> API of Tidy3D. First, we submit the project.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Submit a project to the cluster</span>
<span class="n">project</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">newProject</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">export</span><span class="p">(),</span> <span class="n">taskName</span><span class="o">=</span><span class="s1">&#39;L3 low res&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>And we can continuously monitor the status until the run is succsessful.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">web</span><span class="o">.</span><span class="n">monitorProject</span><span class="p">(</span><span class="n">project</span><span class="p">[</span><span class="s1">&#39;taskId&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Project &#34;L3 low res&#34; status: success...
</pre></div></div>
</div>
<p>Once the run is successful, we can download the results and load them in the simulation object.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>mkdir -p out
<span class="n">web</span><span class="o">.</span><span class="n">downloadResults</span><span class="p">(</span><span class="n">project</span><span class="p">[</span><span class="s1">&#39;taskId&#39;</span><span class="p">],</span> <span class="n">target_folder</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">load_results</span><span class="p">(</span><span class="s1">&#39;out/probe_data.hdf5&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">tprobes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Tidy3D TimeProbe:
name     = tprobe1
center   = [0.0000 0.0000 0.0000]
size     = [0.0000 0.0000 0.0000]
t_start  = 2.50e-13,
t_stop   = 5.00e-13,

Number of time points: 3801
Store E:  True
Store H:  False
Has data: xmesh, ymesh, zmesh, tmesh, E]
</pre></div></div>
</div>
<p>We finally plot the time dependence of the field in the center of the cavity, and the spectrum computed using a Fourier transform of that field.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Get data from the TimeProbe</span>
<span class="n">Nt</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">tprobes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Nt</span>
<span class="n">tmesh</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">tprobes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tmesh</span>
<span class="n">Ey</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">tprobes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># Plot time dependence</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmesh</span><span class="p">,</span> <span class="n">Ey</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Electric field [a.u.]&quot;</span><span class="p">);</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Ey vs. time&quot;</span><span class="p">)</span>

<span class="c1"># Make corresponding frequency mesh</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">tmesh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">tmesh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">tmesh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tmesh</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fmesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">)</span><span class="o">*</span><span class="n">df</span>

<span class="c1"># Fourier transform and plot</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fmesh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">Ey</span><span class="p">)))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">1.7e14</span><span class="p">,</span> <span class="mf">2.3e14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency [Hz]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Electric field [a.u.]&quot;</span><span class="p">);</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Spectrum&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_L3_cavity_21_0.png" src="../_images/examples_L3_cavity_21_0.png" />
</div>
</div>
<p>A single peak is clearly visible, centered just below <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">200THz</span></code>. We do not observe any of the higher-order modes of the L3 cavity because a) the fundamental mode is the longest-lived and b) we use a y-polarized source at the center of the simulation domain, which does not excite some of the other modes. Next, we will look at the field profile of this fundamental mode.</p>
</div>
<div class="section" id="Refine-simulation,-use-symmetries,-get-mode-profile">
<h2>Refine simulation, use symmetries, get mode profile<a class="headerlink" href="#Refine-simulation,-use-symmetries,-get-mode-profile" title="Permalink to this headline">¶</a></h2>
<p>Now that we’ve seen a clear resonant peak, we can increase the resolution of the simulation to obtain more accurate results, and to get a high-resolution image of the cavity mode. To compensate for the increased computation time, we can exploit the reflection symmetries of this problem. Given that the source frequency is already quite close to the peak of the spectrum above, and that we observe a cleanly excited single resonance peak, we will use the same source and run time as above. We just
double the spatial resolution, which, for lattice periodicity of 400nm, will now be equal to 20 mesh cells within a lattice period.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># 20 pixels per lattice period</span>
<span class="n">dl</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">mesh_step</span> <span class="o">=</span> <span class="p">[</span><span class="n">dl</span><span class="p">,</span> <span class="n">dl</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">dl</span><span class="p">]</span>

<span class="c1"># Redefine simulation size because of the PML region</span>
<span class="n">sim_size</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Nx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">alattice</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">npml</span><span class="o">*</span><span class="n">mesh_step</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">((</span><span class="n">Ny</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">alattice</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">npml</span><span class="o">*</span><span class="n">mesh_step</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>We can use both a time and a frequency probe to obtain the field profile, each coming with advantages and disadvantages. The frequency probe captures accurately the frequency-domain field, but that includes the source (apodization will be added in the future). On the other hand, examining the time-domain field can capture the “eigenmode” of the system, but only if all the other modes have decayed. This is, to a very large extent, the case in our simulation, so as we’ll see the second approach
works very well.</p>
<p><strong>NB</strong>: An important thing to note is that a 2D time probe can result in a very large amount of data. Because of this, we will only record the field at the last half of oscillation cycle, namely starting from time <code class="docutils literal notranslate"><span class="pre">t_start</span> <span class="pre">=</span> <span class="pre">run_time</span> <span class="pre">-</span> <span class="pre">1/2/fcen</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Time and frequency probes</span>
<span class="n">tprobe</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">TimeProbe</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="n">t_start</span><span class="o">=</span><span class="n">run_time</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">fcen</span><span class="p">)</span>
<span class="n">fprobe</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">FreqProbe</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="n">freqs</span><span class="o">=</span><span class="n">fcen</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Finally, we initialize the simulation, and also define reflection symmetries with respect to the x-, y-, and z-planes. Note that the eigenvalue of the symmetry (plus or minus one) has to be carefully determined, taking into account the vectorial nature of the electric field (and the pseudo-vector nature of the magnetic field). As an extra hint, positive symmetry is equivalent to a PMC plane, where the <em>normal</em> E-field component vanishes, while negative symmetry is equivalent to a PEC plane,
where the <em>parallel</em> components of the E-field vanish. This is also the reason why in the visualization, we use blue and red to denote these symmetries, which are the same colors used for structures made of PMC and PEC material, respectively.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Initialize simulation</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">sim_size</span><span class="p">,</span>
                 <span class="n">mesh_step</span><span class="o">=</span><span class="n">mesh_step</span><span class="p">,</span>
                 <span class="n">structures</span><span class="o">=</span><span class="p">[</span><span class="n">slab</span><span class="p">]</span><span class="o">+</span><span class="n">holes</span><span class="p">,</span>
                 <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="n">source</span><span class="p">],</span>
                 <span class="n">probes</span><span class="o">=</span><span class="p">[</span><span class="n">tprobe</span><span class="p">,</span> <span class="n">fprobe</span><span class="p">],</span>
                 <span class="n">run_time</span><span class="o">=</span><span class="n">run_time</span><span class="p">,</span>
                 <span class="n">pml_layers</span><span class="o">=</span><span class="n">pml_layers</span><span class="p">,</span>
                 <span class="n">symmetries</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">td</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">relative_eps</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">normal</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">probes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pml</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Initializing simulation...
Simulation domain in number of pixels: 310, 266, 200.
Computation domain (after symmetries): 157, 133, 102.
Mesh step (micron): 2.00e-02, 1.73e-02, 2.00e-02.
Total number of time steps: 15204.
Estimated data size of probe tprobe1: 0.0054GB.
Estimated data size of probe fprobe1: 0.0001GB.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_L3_cavity_28_1.png" src="../_images/examples_L3_cavity_28_1.png" />
</div>
</div>
<p>We run the simulation as above.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">project</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">newProject</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">export</span><span class="p">(),</span> <span class="n">taskName</span><span class="o">=</span><span class="s1">&#39;L3 high res&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">web</span><span class="o">.</span><span class="n">monitorProject</span><span class="p">(</span><span class="n">project</span><span class="p">[</span><span class="s1">&#39;taskId&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Project &#34;L3 high res&#34; status: success...
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">web</span><span class="o">.</span><span class="n">downloadResults</span><span class="p">(</span><span class="n">project</span><span class="p">[</span><span class="s1">&#39;taskId&#39;</span><span class="p">],</span> <span class="n">target_folder</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">load_results</span><span class="p">(</span><span class="s1">&#39;out/probe_data.hdf5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Finally, we plot the field recorded by the frequency probe, with a rescaled colorbar in order to suppress the strongly dominant feature of the source in the center. On the other hand, the field stored in the time probe reveals the eigenmode of the cavity. We plot the last time step, but the field looks the same at all recorded steps, apart from normalization.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">td</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">fprobe_2D</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="s1">&#39;re&#39;</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">))</span>
<span class="n">td</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">tprobe_2D</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">time_ind</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="s1">&#39;re&#39;</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_L3_cavity_34_0.png" src="../_images/examples_L3_cavity_34_0.png" />
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Simulation.html" class="btn btn-neutral float-left" title="Building and running a simulation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Flexcompute 2020

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>